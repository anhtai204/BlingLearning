<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="../assets/css/Index.css">
    <link rel="stylesheet" href="../assets/css/home-footer.css">
    <link rel="stylesheet" href="../assets/css/DuyetCauHoi.css">
    <link rel="stylesheet" href="../assets/fonts/themify-icons/themify-icons.css">
    <style>
        .open {
            display: block;
        }
    </style>
</head>
<body>
    <div id="main">
        <div id="header">
            <div class="nav">
                <div class="logo">
                    <img src="../assets/img/logo2.jpg" alt="Khoa CNTT ĐHSP Hà Nội">
                    <div class="logo-content">
                        <h2>KHOA CÔNG NGHỆ THÔNG TIN</h2>
                        <h3>TRƯỜNG ĐẠI HỌC SƯ PHẠM HÀ NỘI</h3>
                    </div>
                </div>
                
                <div class="content-nav">
                    <li id="course">
                        <div>
                            <i class="ti-book"></i>    
                            <a>Khóa học</a>
                        </div>
                        <ul class="sub-course">
                            <li style="line-height: 34px; margin-left: 20px; margin-top: 5px; font-weight: bold; font-family: sans-serif;">
                                <p>Khóa học của tôi</p>
                            </li>
                            <a href="https://fullstack.edu.vn/courses/html-css">
                                <li id="sub-course-sector">
                                    <img src="../assets/img/html-course.jpg" alt="">
                                        <span id="name-course">HTML CSS từ Zero đến Hero</span>
                                        <span style="text-decoration: underline;" id="start-learn">Bắt đầu học</span>
                                </li>
                            </a>
                            <a href="https://fullstack.edu.vn/courses/javascript-co-ban">
                                <li id="sub-course-sector">
                                    <img src="../assets/img/js-course.jpg" alt="">
                                    <span id="name-course">Lập Trình JavaScript Cơ Bản</span>
                                    <span style="text-decoration: underline;" id="start-learn">Bắt đầu học</span>
                                </li>
                            </a>
                        </ul>
                    </li>

                    <li id="train">
                        <i class="ti-pencil-alt"></i>
                        <a href="LuyenTap.html">Luyện tập</a>
                    </li>

                    <li id="note">
                        <i class="ti-pencil-alt"></i>
                        <a href="DuyetCauHoi.html">Duyệt câu hỏi</a>
                    </li>
                    <li id="account">
                        <div>
                            <i class="ti-user"></i>
                            <a>Account</a>
                        </div>
                        <ul class="sub-account">
                            <li id="support">                              
                                <a><i class="ti-comment-alt"></i><span>&nbsp;Đóng góp ý kiến</span></a>
                            </li>
                            <li id="setting">                               
                                <a href="setting.html"><i class="ti-settings"></i><span>&nbsp;Cài đặt</span></a>
                            </li>
                            <li id="log-out">              
                                <a onclick="logout()" href="DangNhap.html"><i class="ti-power-off"></i><span>&nbsp;Đăng xuất</span></a>
                            </li>
                        </ul>
                    </li>
                </div>
            </div>
        </div>
        <script>
            function logout() {
                localStorage.setItem("current-account","{}");
            }
        </script>
        
        <!-- Đóng góp ý kiến -->

        <div class="contribute-ideas">
            <div id="ideas-head">
                <p>Đóng góp ý kiến</p>
                <i class="ti-close"></i>
            </div>
            <hr>

            <div class="ideas-bottom">
                <li id="ideas-bt">
                    <i class="ti-face-smile"></i>
                    <div>
                        <p style="font-family: sans-serif; font-weight: bold; font-size: 17px;">Chung tay cải thiện trang web</p>
                        <p style="font-family: sans-serif; font-size: 14px; color: #8a8c8f;">Đóng góp ý kiến về trải nghiệm sử dụng của bạn</p>
                    </div>
                </li>
                
                <li id="ideas-bt">
                    <i class="ti-alert"></i>
                    <div>
                        <p style="font-family: sans-serif; font-weight: bold; font-size: 17px;">Đã xảy ra lỗi</p>
                        <p style="font-family: sans-serif; font-size: 14px; color: #8a8c8f;">Hãy cho chúng tôi biết về tính năng bị lỗi</p>
                    </div>
                </li>
            </div>
        </div>
        
        <!--  -->

        <div class="content">
            <li id="content-left">
                <div class="top-content-icon">
                    <a href="../Index.html"><div class="back-home">
                        <i class="ti-home"></i>
                        <p>Trang chủ</p>
                    </div></a>
    
                    <a href="LoTrinh.html"><div class="road">
                        <i class="ti-map"></i>
                        <p>Lộ trình</p>
                    </div></a>
    
                    <a href="BaiViet.html"><div class="notification">
                        <i class="ti-comment-alt"></i>
                        <p>Bài Viết</p>
                    </div></a>
    
                    <a href="TinTuc.html"><div class="announce">
                        <i class="ti-announcement"></i>
                        <p>Tin tức</p>
                    </div></a>
                </div>

                <div class="help">
                    <i class="ti-help-alt"></i>
                    <a href="#">Help</a>
                </div>
            </li>
            <li id="content-right">
                <div class="KhoCH">
                    <a href="KhoCauHoi.html">Kho câu hỏi</a>
                </div>
                <div class="table" id="CauHoi1DA">
                    <h1>Câu hỏi 1 đáp án</h1>
                    <table>
                        <tr>
                            <th>STT</th>
                            <th>Người gửi</th>
                            <th>Thời gian gửi</th>
                            <th>Câu hỏi</th>
                            <th>Đáp án đúng</th>
                            <th>Đáp án sai</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </table>
                </div>
                <div class="table" id="CauHoiNDA">
                    <h1>Câu hỏi đã duyệt</h1>
                    <table>
                        <tr>
                            <th>STT</th>
                            <th>Người gửi</th>
                            <th>Thời gian gửi</th>
                            <th>Câu hỏi</th>
                            <th>Đáp án đúng</th>
                            <th>Đáp án sai</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </table>
                </div>
                <div class="table" id="CauHoiDien">
                    <h1>Câu hỏi chưa duyệt</h1>
                    <table>
                        <tr>
                            <th>STT</th>
                            <th>Người gửi</th>
                            <th>Thời gian gửi</th>
                            <th>Câu hỏi</th>
                            <th>Đáp án đúng</th>
                            <th>Đáp án sai</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </table>
                </div>
            </li>
            <script>
                var current_user=JSON.parse(localStorage["current-account"]);

                // tao 2 gia tri tren localStorage
                localStorage.setItem('cauHoiDaDuyet', "{}")
                localStorage.setItem('cauHoiChuaDuyet', "{}")


                // Bảng câu hỏi 1 đáp án;
                var table_inner=`
                            <tr>
                                <th>STT</th>
                                <th>Người gửi</th>
                                <th>Thời gian gửi</th>
                                <th>Câu hỏi</th>
                                <th>Đáp án đúng</th>
                                <th>Đáp án sai</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>`;
                // chuyển value có key là CauHoi1DA thành object, nếu object rỗng thì thêm chú thích 
                var inner_cauhoi1da=JSON.parse(localStorage["CauHoi1DA"]);
                console.log(inner_cauhoi1da)
                if(Object.entries(inner_cauhoi1da).length==0) {
                    table_inner+=`
                        <tr>
                            <td align="center" colspan="8" id="endof">Chưa có câu hỏi nào được đóng góp</td>
                        </tr>`;
                    document.querySelector("#content-right #CauHoi1DA table").innerHTML=table_inner;

                //ngược lại nếu tồn tại phần tử thì lặp qua tất cả các ptu, chuyển các value của object inner_cauhoi1da
                // thành object và lưu vào bảng
                } else {
                    for(let i=0; i<Object.entries(inner_cauhoi1da).length;i++) {
                        tmp=JSON.parse(inner_cauhoi1da[`CauHoi_${i}`]);
                        table_inner+=`
                            <tr>
                                <td>${i+1}</td>
                                <td>${tmp.user}</td>
                                <td>${tmp.time}</td>
                                <td>${tmp.CauHoi}</td>
                                <td>${tmp.DapAn_Dung}</td>
                                <td>* ${tmp.DapAn_Sai1}<br>* ${tmp.DapAn_Sai2}<br>* ${tmp.DapAn_Sai3}</td>`
                // nếu trạng thái câu hỏi là 0 thì là chưa duyệt, bằng 1 thì đã duyệt
                // nếu account hiện tại có per là admin thì thêm chức năng duyệt
                        if(current_user.per=="admin") {

                            if(tmp.TrangThai=="0") {table_inner+=`<td><button id="duyet_${i}">Duyệt</button></td>`;}
                            else if(tmp.TrangThai=="1") {table_inner+=`<td>Đã duyệt</td>`};
                            table_inner+=`<td><button id="detete_${i}">Xóa</button></td></tr>`;
                        } else {
                            if(tmp.TrangThai=="0") {table_inner+=`<td>Chưa duyệt</td>`;}
                            else if(tmp.TrangThai=="1") {table_inner+=`<td>Đã duyệt</td>`};
                            table_inner+=`<td>~</td></tr>`;
                        }
                        document.querySelector(`#content-right #CauHoi1DA table`).innerHTML=table_inner;
                    }

                    if(current_user.per=="admin") {
                        //button duyệt
                        for(let i=0;i<Object.entries(inner_cauhoi1da).length;i++) {
                            // chuyển value có key là CauHoi1DA thành object, tiếp tục chuyển các value của object Raw_CauHoi thành object
                            let Raw_CauHoi=JSON.parse(localStorage["CauHoi1DA"]);
                            let Raw_inner=JSON.parse(Raw_CauHoi[`CauHoi_${i}`]);
                            let daDuyet = JSON.parse(localStorage["cauHoiDaDuyet"])
                            // console.log(daDuyet)

                            if(Raw_inner.TrangThai==0) {
                                // Gán event onclick vào nút duyệt
                                document.querySelector(`#CauHoiNDA #duyet_${i}`).onclick=function() {
                                    // Trạng thái đã duyệt
                                    Raw_inner.TrangThai=1;
                                    // upload localstorage
                                    Raw_CauHoi[`CauHoi_${i}`]=JSON.stringify(Raw_inner);
                                    console.log(Raw_CauHoi[`CauHoi_${i}`]);
                                    localStorage.setItem("CauHoiNDA",JSON.stringify(Raw_CauHoi));
                                    // Load lại trang web
                                    location.reload();
                                }
                            }
                        }

                        //button xóa
                        for(let i=0; i<Object.entries(inner_cauhoi1da).length;i++) {
                            // Gán event onclick vào nút xóa
                            document.querySelector(`#CauHoi1DA #detete_${i}`).onclick=function() {
                                let Raw_CauHoi=JSON.parse(localStorage["CauHoi1DA"]);
                                for(let j=i;j<Object.entries(inner_cauhoi1da).length-1;j++) {
                                    Raw_CauHoi[`CauHoi_${j}`]=Raw_CauHoi[`CauHoi_${j+1}`];
                                }

                                delete Raw_CauHoi[`CauHoi_${Object.entries(inner_cauhoi1da).length-1}`];
                                console.log(Raw_CauHoi);
                                localStorage.setItem("CauHoi1DA",JSON.stringify(Raw_CauHoi));
                                location.reload();
                            }
                        }
                    }
                }


            
                // Bảng câu hỏi đã duyệt
                inner_cauhoi=JSON.parse(localStorage["CauHoiNDA"]);
                var inner_CauHoiNDA=Object.entries(inner_cauhoi);
                var table_inner=`
                        <tr>
                            <th>STT</th>
                            <th>Người gửi</th>
                            <th>Thời gian gửi</th>
                            <th>Câu hỏi</th>
                            <th>Đáp án đúng</th>
                            <th>Đáp án sai</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>`;
                if(inner_CauHoiNDA.length==0) {
                    table_inner+=`
                        <tr>
                            <td align="center" colspan="8">Chưa có câu hỏi nào được duyệt</td>
                        </tr>`;
                    document.querySelector("#content-right #CauHoiNDA table").innerHTML=table_inner;
                } else {
                    for(let i=0;i<inner_CauHoiNDA.length;i++) {
                        // tạo object tmp là biến chuyển từ value của mảng inner_CauHoiNDA[vị tri dò][1] 
                        tmp=JSON.parse(inner_CauHoiNDA[i][1])
                        console.log(tmp);
                        tmp_dung=JSON.parse(tmp.DapAnDung); // lưu object các DapAnDung của tmp
                        console.log(tmp_dung) // object {DADung_1: 're', DADung_2: '', DADung_3: '', DADung_4: ''}
                        // lấy ra phần từ của object tmp_dung : tmp_dung.DADung_1 = tmp_dun["DADung_1"]
                        tmp_sai=JSON.parse(tmp.DapAnSai);
                        table_inner+=`
                            <tr>
                                <td>${i+1}</td>
                                <td>${tmp.user}</td>
                                <td>${tmp.time}</td>
                                <td>${tmp.CauHoi}</td>
                                    <td>* ${tmp_dung.DADung_1}`;
                        if(tmp_dung.DADung_2!="") table_inner+=`<br>* ${tmp_dung.DADung_2}`;
                        if(tmp_dung.DADung_3!="") table_inner+=`<br>* ${tmp_dung.DADung_3}`;
                        if(tmp_dung.DADung_4!="") table_inner+=`<br>* ${tmp_dung.DADung_4}`;

                        table_inner+=`</td><td>* ${tmp_sai.DASai_1}`;

                        if(tmp_sai.DASai_2) table_inner+=`<br>* ${tmp_sai.DASai_2}`;
                        if(tmp_sai.DASai_3) table_inner+=`<br>* ${tmp_sai.DASai_3}`;
                        if(tmp_sai.DASai_4) table_inner+=`<br>* ${tmp_sai.DASai_4}`;
                        table_inner+=`</td>`
                        
                        if(current_user.per=="admin") {

                            if(tmp.TrangThai=="0") {table_inner+=`<td><button id="duyet_${i}">Duyệt</button></td>`;}
                            else if(tmp.TrangThai=="1") {table_inner+=`<td>Đã duyệt</td>`};
                            table_inner+=`<td><button id="detete_${i}">Xóa</button></td></tr>`;
                        } else {
                            if(tmp.TrangThai=="0") {table_inner+=`<td>Chưa duyệt</td>`;}
                            else if(tmp.TrangThai=="1") {table_inner+=`<td>Đã duyệt</td>`};
                            table_inner+=`<td>~</td></tr>`;
                        }
                        document.querySelector("#content-right #CauHoiNDA table").innerHTML=table_inner;
                    }

                    var inner_cauhoinda=JSON.parse(localStorage["CauHoiNDA"]);
                    if(current_user.per=="admin") {
                        //button duyệt
                        for(let i=0;i<Object.entries(inner_cauhoinda).length;i++) {
                            // Lấy object câu hỏi raw và kho câu hỏi nhiều đáp án từ local storage
                            let Raw_CauHoi=JSON.parse(localStorage["CauHoiNDA"]);
                            let Raw_inner=JSON.parse(Raw_CauHoi[`CauHoi_${i}`]);
                            if(Raw_inner.TrangThai==0) {
                                // Gán event onclick vào nút duyệt
                                document.querySelector(`#CauHoiNDA #duyet_${i}`).onclick=function() {
                                    // Trạng thái đã duyệt
                                    Raw_inner.TrangThai=1;
                                    // upload localstorage
                                    Raw_CauHoi[`CauHoi_${i}`]=JSON.stringify(Raw_inner);
                                    console.log(Raw_CauHoi[`CauHoi_${i}`]);
                                    localStorage.setItem("CauHoiNDA",JSON.stringify(Raw_CauHoi));
                                    // Load lại trang web
                                    location.reload();
                                }
                            }
                        }
                        //button xóa
                        for(let i=0; i<Object.entries(inner_cauhoinda).length;i++) {
                            // Gán event onclick vào nút xóa
                            document.querySelector(`#CauHoiNDA #detete_${i}`).onclick=function() {
                                console.log(Object.entries(inner_cauhoinda).length);
                                let Raw_CauHoi=JSON.parse(localStorage["CauHoiNDA"]);
                                for(let j=i;j<Object.entries(inner_cauhoinda).length-1;j++) {
                                    // Bắt đầu từ thuộc tính có stt i+1
                                    // Gán giá trị của thuộc tính câu hỏi này bằng giá trị của thuộc tính câu hỏi sau nó
                                    Raw_CauHoi[`CauHoi_${j}`]=Raw_CauHoi[`CauHoi_${j+1}`];
                                }

                                // Xóa thuộc tính cuối cùng của object
                                delete Raw_CauHoi[`CauHoi_${Object.entries(inner_cauhoinda).length-1}`];
                                console.log(Raw_CauHoi);
                                localStorage.setItem("CauHoiNDA",JSON.stringify(Raw_CauHoi));
                                // Load lại trang web
                                location.reload();
                            }
                        }
                    }
                }

                // Bảng câu hỏi chưa được duyệt
                inner_cauhoi=JSON.parse(localStorage["CauHoiDien"]);
                var inner_CauHoiDien=Object.entries(inner_cauhoi);
                var table_inner=`
                        <tr>
                            <th>STT</th>
                            <th>Người gửi</th>
                            <th>Thời gian gửi</th>
                            <th>Câu hỏi</th>
                            <th>Đáp án đúng</th>
                            <th>Đáp án sai</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>`;
                if(inner_CauHoiDien.length==0) {
                    table_inner+=`
                        <tr>
                            <td align="center" colspan="8">Chưa có câu hỏi nào được đóng góp</td>
                        </tr>`;
                    document.querySelector("#content-right #CauHoiDien table").innerHTML=table_inner;
                } else {
                    for(let i=0; i<inner_CauHoiDien.length;i++) {
                        tmp=JSON.parse(inner_CauHoiDien[i][1]);
                        table_inner+=`
                            <tr>
                                <td>${i+1}</td>
                                <td>${tmp.user}</td>
                                <td>${tmp.time}</td>
                                <td>${tmp.CauHoi}</td>
                                <td>${tmp.DapAn}</td>
                                <td>~</td>`
                        
                        if(current_user.per=="admin") {

                            if(tmp.TrangThai=="0") {table_inner+=`<td><button id="duyet_${i}">Duyệt</button></td>`;}
                            else if(tmp.TrangThai=="1") {table_inner+=`<td>Đã duyệt</td>`};
                            table_inner+=`<td><button id="detete_${i}">Xóa</button></td></tr>`;
                        } else {
                            if(tmp.TrangThai=="0") {table_inner+=`<td>Chưa duyệt</td>`;}
                            else if(tmp.TrangThai=="1") {table_inner+=`<td>Đã duyệt</td>`};
                            table_inner+=`<td>~</td></tr>`;
                        }
                        document.querySelector("#content-right #CauHoiDien table").innerHTML=table_inner;
                    }
                    
                     var inner_cauhoidien=JSON.parse(localStorage["CauHoiDien"]);
                    if(current_user.per=="admin") {
                        //button duyệt
                        for(let i=0;i<Object.entries(inner_cauhoidien).length;i++) {
                            // Lấy object câu hỏi raw và kho câu hỏi điền đáp án từ local storage
                            let Raw_CauHoi=JSON.parse(localStorage["CauHoiDien"]);
                            let Raw_inner=JSON.parse(Raw_CauHoi[`CauHoi_${i}`]);
                            if(Raw_inner.TrangThai==0) {
                                // Gán event onclick vào nút duyệt
                                document.querySelector(`#CauHoiDien #duyet_${i}`).onclick=function() {
                                    // Trạng thái đã duyệt
                                    Raw_inner.TrangThai=1;
                                    // upload localstorage
                                    Raw_CauHoi[`CauHoi_${i}`]=JSON.stringify(Raw_inner);
                                    console.log(Raw_CauHoi[`CauHoi_${i}`]);
                                    localStorage.setItem("CauHoiDien",JSON.stringify(Raw_CauHoi));
                                    // Load lại trang web
                                    location.reload();
                                }
                            }
                        }
                        //button xóa
                        for(let i=0; i<Object.entries(inner_cauhoidien).length;i++) {
                            // Gán event onclick vào nút xóa
                            document.querySelector(`#CauHoiDien #detete_${i}`).onclick=function() {
                                let Raw_CauHoi=JSON.parse(localStorage["CauHoiDien"]);
                                for(let j=i;j<Object.entries(inner_cauhoidien).length-1;j++) {
                                    // Bắt đầu từ thuộc tính có stt i+1
                                    // Gán giá trị của thuộc tính câu hỏi này bằng giá trị của thuộc tính câu hỏi sau nó
                                    Raw_CauHoi[`CauHoi_${j}`]=Raw_CauHoi[`CauHoi_${j+1}`];
                                }

                                // Xóa thuộc tính cuối cùng của object
                                delete Raw_CauHoi[`CauHoi_${Object.entries(inner_cauhoidien).length-1}`];
                                console.log(Raw_CauHoi);
                                localStorage.setItem("CauHoiDien",JSON.stringify(Raw_CauHoi));
                                // Load lại trang web
                                location.reload();
                            }
                        }
                    }
                }

            </script>
        </div>
    </div>

    <div class="home-footer">
        <div class="image">
            <img src="../assets/img/logo2.jpg" alt="">
        </div>
        <div class="info">
            <span>Nhóm 12 - NTPTW01 - K72 Nền Tảng Phát Triển Web</span><br>
            <span>1 Tháng 12, 2023</span>
        </div>
        <div class="tag">
            <span>Khoa Công nghệ thông tin - Trường Đại học Sư phạm Hà Nội 2023</span>
        </div>
    </div>
    <script>

        // Account sub
        const sub_account = document.querySelector('.sub-account');
        const user_avt = document.querySelector('#account > div');


        function showAccount() {
            if(sub_course.classList.contains('open')) {
                sub_course.classList.remove('open')
            }
            sub_account.classList.toggle('open');
        }

        user_avt.addEventListener('click', showAccount)


        // Course sub
        const sub_course = document.querySelector('.sub-course');
        const course_avt = document.querySelector('#course > div');


        function showCourse() {
            if(sub_account.classList.contains('open')) {
                sub_account.classList.remove('open')
            }
            sub_course.classList.toggle('open');
        }
        
        course_avt.addEventListener('click', showCourse)

        // Contribute ideas
        const show_ideas = document.querySelector('.sub-account #support');
        const sub_ideas = document.querySelector('.contribute-ideas');
        const ideas_avt = document.querySelector('#ideas-head .ti-close');

        function showContribute() {
            if(sub_account.classList.contains('open')) {
                sub_account.classList.remove('open')
            }
            sub_ideas.classList.add('open');
        }

        function hideContribute() {
            sub_ideas.classList.remove('open')
        }

        show_ideas.addEventListener('click', showContribute);
        ideas_avt.addEventListener('click', hideContribute);

    </script>
</body>
</html>